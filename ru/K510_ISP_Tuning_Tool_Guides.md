![](../zh/images/canaan-cover.png)

**<font face="黑体" size="6" style="float:right">Руководства по инструментам настройки K510 ISP</font>**

<font face="黑体"  size=3>Версия документа: V1.0.0</font>

<font face="黑体"  size=3>Опубликовано: 2022-03-31</font>

<div style="page-break-after:always"></div>

<font face="黑体" size=3>**Отказ**</font>
Продукты, услуги или функции, которые вы покупаете, регулируются коммерческими контрактами и условиями Beijing Canaan Jiesi Information Technology Co., Ltd. («Компания», то же самое далее), и все или часть продуктов, услуг или функций, описанных в этом документе, могут не входить в сферу вашей покупки или использования. Если иное не оговорено в договоре, Компания отказывается от всех заявлений или гарантий, явных или подразумеваемых, в отношении точности, надежности, полноты, маркетинга, конкретной цели и ненападения любых заявлений, информации или содержания этого документа. Если не согласовано иное, настоящий документ предоставляется только в качестве руководства для использования.
В связи с обновлением версии продукта или по другим причинам содержимое этого документа может время от времени обновляться или изменяться без какого-либо уведомления. 

**<font face="黑体"  size=3>Уведомления о товарных знаках</font>**

""<img src="../zh/images/canaan-logo.png" style="zoom:33%;" />, значок "Canaan", Canaan и другие товарные знаки Canaan и другие товарные знаки Canaan являются товарными знаками Beijing Canaan Jiesi Information Technology Co., Ltd. Все другие товарные знаки или зарегистрированные товарные знаки, которые могут быть упомянуты в этом документе, принадлежат их соответствующим владельцам. 

**<font face="黑体"  size=3>Copyright ©2022 Пекин Ханаан Цзеси Информационные технологии Co., Ltd</font>**
Настоящий документ применим только к разработке и проектированию платформы K510, без письменного разрешения компании, ни одно подразделение или частное лицо не может распространять часть или все содержание этого документа в любой форме. 

**<font face="黑体"  size=3>Пекин Ханаан Цзеси Информационные Технологии Co., Ltd</font>**
URL: canaan-creative.com
Бизнес-запросы: salesAI@canaan-creative.com

<div style="page-break-after:always"></div>
# предисловие
**<font face="黑体"  size=5>Назначение </font>**документа
Этот документ представляет собой документацию по инструменту настройки поставщика услуг Интернета. 

**<font face="黑体"  size=5>Объекты чтения</font>**

Основной аудиторией этого документа являются опытные инженеры-программисты, инженеры по алгоритмам создания образов, системные дизайнеры и системные интеграторы, которые хотят реализовать проприетарные приложения и драйверы.

**<font face="黑体"  size=5>История изменений</font>**
 <font face="宋体"  size=2>Журнал изменений накапливает описание каждого обновления документа. Последняя версия документа содержит обновления для всех предыдущих версий. </font>

| Номер версии   | Изменено     | Дата пересмотра | Примечания к пересмотру |
|  :-----  |-------   |  ------  |  ------  |
| Версия 1.0.0 | Группы системного программного обеспечения | 2022-03-31 | Выпущен пакет SDK V1.6 |

<div style="page-break-after:always"></div>
**<font face="黑体"  size=6>Содержание</font>**

[ОГЛАВЛЕНИЯ]

<div style="page-break-after:always"></div>

# Введение в инфраструктуру инструментов настройки isp

В этом разделе описываются средства настройки поставщика услуг Интернета и описания потоков данных, предоставляемых процессорам верхнего уровня для управления общей оптимизацией образа поставщика услуг Интернета.

```text
+----------------------------------------------------+
|                                                    |
|                      K510                          |
|                                                    |
|    +-------+        +--------------------------+   |
|    |       |        |                          |   |
|    |  ISP  +------> |   v4l2_drm_isptool.out   |   |
|    |       |        |                          |   |
|    +-------+        +-------------+------------+   |
|                                   |                |
|                                   |                |
|    +-----------------+            |                |
|    |                 |            |                |
|    |   isp-tuningd   | <----------+                |
|    |                 |                             |
|    +^-+--------------+                             |
|     | |                                            |
|     | |                                            |
+----------------------------------------------------+
      | |
      | |
+-------------------------------+
|     | |                       |
|     | |       PC              |
|     | |                       |
|    ++-v------------------+    |
|    |                     |    |
|    |  ISP Tuning Tool    |    |
|    |                     |    |
|    +---------------------+    |
|                               |
+-------------------------------+
```

## Настройка трафика инструмента

Протокол связи можно найти в документации в репозитории клиентского кода, и инструмент состоит из двух частей, одна из которых является клиентом isp-tuningd, запущенным на ПК, программа находится в /app/mediactl_lib/isp-tuningd, а другая часть является сервером, работающим на K510. По умолчанию для связи используется TCP-порт 9982.

### клиент

Средство настройки поставщика услуг Интернета — это приложение, которое выполняется на ПК. Помимо возможности установки регистров, также поддерживаются калибровка AWB и калибровка CCM.

### Серверная часть

isp-tuningd получает изображение yuv (NV12) размером 3133440 байт со стандартного входа и транслирует его всем клиентам, мы можем использовать v4l2_drm_isptool, он автоматически запустит isp-tuningd и отправит данные изображения, конкретное использование соответствует v4l2_drm. Мы можем запустить его с помощью следующей команды

```shell
cd /app/mediactl_lib
./v4l2_drm_isptool -f video_drm_1080x1920.conf
```

# Параметры настройки интернет-провайдера

Многие регистры и таблицы предоставляются в K510 ISP для управления и настройки. Настройка аппаратных регистров ISP очень важна для качества изображения. В настоящее время на платформе K510 процесс настройки образа реализован только через TCP Socket.

## Главное окно инструмента настройки

В этом разделе описываются особенности этих панелей в окне настройки.

На рисунке 3-1 показана вся панель оператора в окне настройки

- Панель 1 — это** меню**, которое может дополнительно загрузить настроенный файл ISP или выполнить калибровку. 
- Панель 2 представляет собой **панель управления подключением**, заполните IP-адрес и номер порта платы разработки (порт по умолчанию 9982) и нажмите зеленую кнопку подключения для подключения. 
- Панель 3 является панелью** регистров**, если вам нужно установить или прочитать регистр не в этой, вы можете использовать эту панель для установки и чтения. 
- Панель 4 представляет собой** панель выбора параметров настройки**, пользователь может выбирать различные параметры или группы параметров в соответствии с текстом подсказки панели, регистры этих выделений будут отображаться на панели 5. 
- Панель 5 — это **панель настроек параметров настройки**, которая используется для установки или получения значений параметров с сервера настройки. 
- Панель 6 представляет собой **панель отображения изображения**, которая отображает вывод изображения интернет-провайдером и может нажимать кнопку паузы посередине, когда нет необходимости играть все время. 

![Рисунок 3-1 Главное окно инструмента настройки](../zh/images/sdk_application/clip_image033.png)

Инструмент настройки ISP** не **получает автоматически все значения регистров после подключения, и если вам нужно получить все значения регистров, вы можете нажать** кнопку «Прочитать» в правой части панели управления подключением**, чтобы извлечь все текущие значения регистров. 

# Калибровка и калибровка

В этом разделе описываются инструкции по калибровке и калибровке с помощью инструментов настройки ISP, включая автоматический баланс белого (AWB), матрицу цветокоррекции (CCM), гамму и тени объектива (LSC).

## AWB

### Препараты

1. Стандартный световой короб со стандартным источником света D65
2. Стандартная 24-цветная карта, в настоящее время поддерживается только цветная карта X-RITE
3. Камера, готовая к калибровке, может выводить исходное изображение датчика или обработанное изображение
4. ISP также только открывает модуль коррекции уровня черного и демазаизаичного алгоритма, CSC и другие модули преобразования форматов должны обращать внимание на симметрию (матрица является обратной матрицей), помимо шумоподавления, резкости и другие модули оказывают небольшое влияние, но также стараться закрывать, нелинейные модули и модули обработки цвета (GAMMA, wide dynamic, AWB, CCM, регулировка насыщенности и т.д.) должны быть отключены

### Получает изображение

1. Камера направлена на 24-цветную карту, убедитесь, что 24-цветная карта заполняет все изображение, а затем захватите изображение, которое можно щелкнуть, чтобы приостановить воспроизведение без гарантии точности, как показано на следующем рисунке

    ![Рисунок 4-1 Взято 24 цветных карты](../zh/images/sdk_application/clip_image014.jpg)

2. На захваченном изображении следует обратить внимание на умеренную яркость и темноту, а слишком яркое и слишком темное повлияет на калибровку.

### разграничивать

Нажмите «Калибровка» в строке меню, выберите «AWB» для выполнения калибровки, и программа автоматически выберет цветовую карту

![Рисунок 4-2 Автоматический выбор цвета коробки](../zh/images/sdk_application/clip_image016.jpg)

Нажмите любую клавишу, чтобы продолжить, открывая изображение после завершения баланса белого

![Рисунок 4-3 Полная калибровка AWB](../zh/images/sdk_application/clip_image018.jpg)

Если проблем нет, продолжайте нажимать любую клавишу, инструмент выскочит диалоговое окно с вопросом, является ли параметр разумным, да заполнит его в основной интерфейс, связанный с регистрами, в противном случае откажитесь от результата калибровки, если это так, инструмент продолжит спрашивать, следует ли записывать в регистр устройства.

## КУБОВЫЙ

В соответствии с калибровкой AWB он не будет повторяться.

## Гамма

Формула для стандартной гамма-кривой
$$
Y=aX^b
$$
Где $b$ — гамма-коэффициент, который обычно меньше 1 в конце изображения и больше 1 в конце дисплея. Значение $a$ может быть рассчитано на основе значения $b$

$$
a=\frac{256}{256^b}
$$
Принцип формулы заключается в том, что вход равен 256, что все еще равно 256 после гамма-коррекции.

Когда гамма-коэффициент b равен 0,5, кривая показана на следующем рисунке

![](../zh/images/sdk_application/clip_image025.png)

## ЛСК

### Препараты

- Снимок захватывает фотографию в формате RAW

### принцип

Поскольку центр объектива не согласуется с окружающей светопропускаемостью, яркость изображения неравномерна, поэтому соответствие кривой генерирует корректирующую поверхность, чтобы компенсировать эту проблему.

Коррекция показана на рисунке ниже

![Перед коррекцией](../zh/images/sdk_application/clip_image029.png)

После коррекции он показан на следующем рисунке

![После коррекции](../zh/images/sdk_application/clip_image031.png)

**Отказ от ответственности за **перевод  
Для удобства клиентов Canaan использует переводчик AI для перевода текста на несколько языков, которые могут содержать ошибки. Мы не гарантируем точность, надежность или своевременность предоставленных переводов. Компания Canaan не несет ответственности за любые убытки или ущерб, вызванные доверием к точности или надежности переведенной информации. При наличии разницы в содержании переводов на разные языки преимущественную силу имеет упрощенная версия на китайском языке. 

Если вы хотите сообщить об ошибке или неточности перевода, пожалуйста, не стесняйтесь обращаться к нам по почте.